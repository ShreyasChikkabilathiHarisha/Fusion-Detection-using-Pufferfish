# Fusion-Detection-using-Pufferfish


# Pipeline to Build Index on Combined Human Genome - Transcriptome reference:

Download both human transcriptome and human genome reference fasta files and then concatenate both the files into one file (example: human_genome_transcriptome_reference.fa).
Now use this as the input to pufferfish fixFasta binary to create fixed fasta file.
 
Note: In this experiment, i used the fixed fasta files stored on Zendo for both human genome and human transcriptome and combined them to create human_genome_transcriptome_fixed.fa fasta file.Link: https://zenodo.org/record/995689/files/gencode.v25.pc_transcripts_fixed.fa and https://zenodo.org/record/995689/files/GRCh38.primary_assembly.genome.fixed.fa

After we have human_genome_transcriptome_fixed.fa, we give this fixed fasta file as input to graphconstructor of twopaco, which creates deBruijnGraph out of the fixed fasta. Then gfa graph dumps are created using graphdump binary of TwoPaCo.
This graph dump gfa is pufferized to create pufferized gfa, which is used to create pufferfish index on the combined reference fixed fasta.


The pufferfish index of the human_genome_transcriptome reference is stored for mapping the RNA sequence reads against these reference indices.

After we have the index ready, we can take the cancerous RNA sample read and align against human_genome_transcriptome reference index. This creates sam file which has the complete information of all the alignments of the sample reads against the reference index.

# Fusion detection criterion / Algorithm:
	In order to detect fusion, followed the approach as mentioned below:
First read and store all the reads and their corresponding alignment to the reference along with the read seq in an unordered multimap (mappedRefs) foreach readName. Hence each readName may contain one or more chromosome/transcript alignment. (Example: R_57206:1 readName contains a list of alignments like [‘chr9’, ‘ENST00000223528.6|ENSG00000106692.13|OTTHUMG00000020425.4|OTTHUMT00000053505.1|FKTN-001|FKTN|7364|UTR5:1-124|CDS:125-1510|UTR3:1511-7364|’]). As we can see, each chromosome/ transcriptome info is used to map the genome to the chromosome.
While storing all the alignment information in the multimap, we can collect the list of chromosomes that the sample read aligned to, in the reference.
Now, foreach of the chromosomes, we can get the readNames and there after, all the Transcriptomes that aligned to those corresponding readNames.
Every time a particular transcriptome alignment is encountered, a count maintained for that respective transcriptome is incremented by one. This helps to choose only the transcriptomes with a minimum count of alignments encountered. This is a filter to avoid false positives.
With the list of all the aligned transcriptomes, after a certain amount of filtering (only genes with more than 0.00015 times the total alignments corresponding to the readNames of all the chromosomes are selected), we can extract all the genes from which the chromosomes originated. This gives the fusion of genes in that respective sample RNA seq.

# Dataset for Fusion Detection:
	For this experiment, i have used simulated dataset from the experiment in FusionMap: detecting fusion genes from next-generation sequencing data at base-pair resolution (Link: http://omicsoft.com/downloads/FusionMap/FusionMap_2018-01-08.zip Dataset in TestDataset/input/DatasetP2_simulatedReads fastq files ).

	It is a simulated dataset of paired-end RNA seq based on human embryonic stem cells background, which is not expected to harbor fusion transcripts. SRR065491 and SRR066679, which were generated by the ENCODE Caltech RNA-Seq project (Birney et al., 2007; Raney et al., 2010), are used to generate the dataset P2 with 75 nt paired-end reads from 50 simulated fusion transcripts, mixed with background reads

# Instruction to run:

	g++ countFusionGenes.cpp -std=c++11 -o job
	
	./job <DatasetP2_SimulatedReads_cancer.sam>

# Results:
	The pufferfish alignment sam file of the sample RNA seq, created against the human_genome_transcriptome reference index is given as input to the program.

A safe count of minimum 9 alignments (57764 * 0.00015 = 9) is assumed to remove false positives.
The time taken to detect fusion for the P2 dataset used here is 10.32 seconds.
